# BE_V1_AUTH_001 : 회원가입
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | BE_V1_AUTH_001 |
| **요구사항명** | 회원가입 및 신규 세션 강제 종료 |
| **우선순위** | 필수 (P1) |
| **설명** | 사용자가 이름, 핀번호, 전화번호를 입력하여 가입을 완료하면, 보안을 위해 토큰을 파기하고 로그인 페이지로 이동하여 첫 음성 안내를 시작한다. |
| **선행조건** | - 서비스 회원가입 화면(음성 가이드 작동 중)에서 모든 정보를 입력함. |
| **후행조건** | - 가입 완료와 동시에 발급된 토큰 삭제 및 로그인 화면으로 리다이렉트 |
| **입력** | - 전화번호 (phone_number)<br>- 이름 (name)<br>- 핀번호 (pin_number) |
| **출력** | **- 음성 안내**: "회원가입이 완료되었습니다. 이제 로그인 화면으로 이동됩니다. 로그인 화면에서 PIN 번호를 입력해주세요" |
| **비즈니스 규칙** | - **로컬 캐시 관리**: 토큰 파기 후, 로컬 저장소(Cookie, LocalStorage) 내 세션 정보 삭제. 캐시 만료는 30일 후.<br>- 회원가입 성공 직후 서버에서 발급된 토큰(있을 경우)은 즉시 파기함.<br>- 프론트엔드의 LocalStorage/Cookie 내 토큰 정보를 삭제함. |
| **예외 처리** | - 전화번호 중복 시 오류 메시지: "이 전화번호는 이미 등록되어 있습니다. 다른 전화번호를 입력해 주세요."<br>- PIN 번호 길이가 짧을 경우: "PIN 번호는 최소 4자리 이상이어야 합니다. 다시 입력해 주세요.” |

# BE_V1_AUTH_002: 로그인
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | BE_V1_AUTH_002 |
| **요구사항명** | 로그인 |
| **우선순위** | 필수 (P1) |
| **설명** | 로그인 성공 시 사용자의 프로필 상태를 조회하여, 웰니스 솔루션 제공을 위한 필수 정보가 없으면 정보 입력 페이지로, 모두 있으면 메인 기능 페이지로 이동시킨다. |
| **선행조건** | - AUTH-001 회원가입 완료 후 로그인 시도. |
| **후행조건** | - 데이터 상태에 따라 음성 메인 페이지 또는 정보 보충 입력 페이지로 리다이렉트. 로컬 캐시 재발급. |
| **입력** | - 전화번호 (phone_number)<br>- PIN 번호 (pin_number)<br>- 디바이스 ID (device_id) |
| **출력** | - **로그인 성공 시 (사용자 프로필 데이터 O)**: "로그인이 완료되었습니다. 메인 페이지로 이동합니다."<br>- **로그인 성공 시 (사용자 프로필 데이터 X)**: "로그인이 완료되었습니다. 정확한 가이드를 위해 사용자 데이터 수집 화면으로 전환됩니다."<br>- **로그인 실패 시**: "로그인이 실패했습니다. 전화번호 또는 PIN 번호가 잘못되었습니다. 다시 확인해주세요." |
| **비즈니스 규칙** | - **Access Token** 15분 유효<br>- **Refresh Token** 7일 유효<br>- **검증 로직**: `(phone_number == null OR height == null OR weight == null)` 확인.<br>- 필수 정보가 하나라도 누락된 사용자는 메인 기능 URL에 접근하더라도 시스템이 자동으로 정보 입력 페이지로 리다이렉트 (Route Guard). |
| **예외 처리** | - 잘못된 형식의 정보 입력 시: "숫자만 입력 가능합니다. 다시 말씀해 주세요."<br>- 정보 입력 중 이탈 시, 다음 로그인 때 다시 정보 입력 페이지로 유도.<br>- 디바이스 변경 식별 시 추가 인증 필요 (옵션) |

# BE_V1_AUTH_003: 소셜 로그인 (Google)
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | BE_V1_AUTH_003 |
| **요구사항명** | Google OAuth2 로그인 |
| **우선순위** | 필수 (P1) |
| **설명** | Google 계정으로 로그인하거나 회원가입을 처리한다. 로그인 후, **Access Token**과 **Refresh Token**을 발급하고, 사용자의 기본 정보를 확인한다. 필수 정보가 부족한 경우 **메인 기능을 차단**하고, 정보 입력 페이지로 리다이렉트한다. |
| **선행조건** | - 사용자가 Google 계정을 보유하고 있어야 하며, Google 계정으로 로그인 시도가 이루어진다. |
| **후행조건** | - **Access Token**, **Refresh Token** 발급<br>- 사용자 정보가 없을 경우 자동 회원가입 처리<br>- 필수 정보가 누락되었을 경우, 정보 입력 페이지로 리다이렉트 |
| **입력** | - **Google OAuth 인가 코드**<br>- **디바이스 ID (device_id)** |
| **출력** | - **Access Token**<br>- **Refresh Token**<br>- **사용자 정보** (이름, 이메일 등) |
| **비즈니스 규칙** | - 기존 사용자와 동일 인물 분리<br>- 신규 사용자 자동 생성<br>- 소셜 인증 직후 토큰을 발급하되, 필수 정보가 누락된 경우 서비스 메인 기능을 차단함 |
| **예외 처리** | - OAuth 인가 실패 시: "Google 계정 인증에 실패했습니다. 다시 시도해 주세요.” |

# BE_V1_AUTH_004: 소셜 로그인 (Kakao)
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | BE_V1_AUTH_004 |
| **요구사항명** | Kakao OAuth2 로그인 |
| **우선순위** | 필수 (P1) |
| **설명** | Kakao 계정으로 로그인하거나 회원가입을 처리한다. 로그인 후, **Access Token**과 **Refresh Token**을 발급하고, 사용자의 기본 정보를 확인한다. 필수 정보가 부족한 경우 **메인 기능을 차단**하고, 정보 입력 페이지로 리다이렉트한다. |
| **선행조건** | - 사용자가 Kakao 계정을 보유하고 있어야 하며, Kakao 계정으로 로그인 시도가 이루어진다. |
| **후행조건** | - **Access Token**, **Refresh Token** 발급<br>- 사용자 정보가 없을 경우 자동 회원가입 처리<br>- 필수 정보가 누락된 경우, 정보 입력 페이지로 리다이렉트 |
| **입력** | - **Kakao OAuth 인가 코드**<br>- **디바이스 ID (device_id)** |
| **출력** | - **Access Token**<br>- **Refresh Token**<br>- **사용자 정보** (이름, 이메일 등) |
| **비즈니스 규칙** | - 기존 사용자와 동일 인물 분리<br>- 신규 사용자 자동 생성<br>- 소셜 인증 직후 토큰을 발급하되, 필수 정보가 누락된 경우 서비스 메인 기능을 차단함 |
| **예외 처리** | - **OAuth 인가 실패 시**: "Kakao 계정 인증에 실패했습니다. 다시 시도해 주세요." |

# BE_V1_AUTH_005: 로그아웃
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | BE_V1_AUTH_005 |
| **요구사항명** | 로그아웃 |
| **우선순위** | 필수 (P1) |
| **설명** | 현재 세션을 종료하고, **Refresh Token**을 블랙리스트에 등록하며, 클라이언트의 토큰을 삭제한다. |
| **선행조건** | - 사용자가 로그인 상태여야 하며, **Refresh Token**을 가지고 있어야 한다. |
| **후행조건** | - **Refresh Token** 블랙리스트 등록<br>- 클라이언트 토큰 삭제 |
| **입력** | - **Refresh Token** |
| **출력** | - **로그아웃 완료 메시지**: "로그아웃이 완료되었습니다. 다시 로그인해주세요." |
| **비즈니스 규칙** | - **Refresh Token** 무효화<br>- 클라이언트 **Access Token**과 **Refresh Token** 삭제 |
| **예외 처리** | - **로그인 상태가 아닐 경우**: "로그인 상태가 아닙니다. 먼저 로그인해주세요."<br>- **Refresh Token 만료 시**: "로그아웃할 수 없습니다. 토큰이 만료되었습니다. 다시 로그인해주세요." |

# BE_V1_AUTH_006: 회원탈퇴
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | BE_V1_AUTH_006 |
| **요구사항명** | 회원탈퇴 |
| **우선순위** | 필수 (P1) |
| **설명** | 계정과 연결된 모든 데이터(신체 정보, 활동 기록 등)를 삭제하고 관계를 종료한다. 탈퇴 후, 모든 데이터가 삭제되며, 인증 토큰이 파기된다. |
| **선행조건** | - 사용자가 로그인 상태여야 한다. |
| **후행조건** | - 모든 데이터 삭제 후, 인증 토큰 파기<br>- 초기 랜딩 페이지(또는 로그인 페이지)로 리다이렉트 |
| **입력** | - 탈퇴 최종 확인 의사 |
| **출력** | - **음성 안내**: "회원탈퇴가 완료되었습니다. 그동안 시선을 이용해 주셔서 감사합니다." |
| **비즈니스 규칙** | - **사용자 정보 삭제 후 로그아웃**: 사용자의 모든 정보 삭제 후 로그아웃<br>- **클라이언트 토큰 삭제**: 로컬 저장소(Cookie, LocalStorage) 내 모든 토큰 삭제 |
| **예외 처리** | - **탈퇴 확인 미입력 시**: "회원탈퇴를 진행하려면, 탈퇴 의사를 확인해 주세요."<br>- **탈퇴 중 오류 발생 시**: "회원탈퇴 중 오류가 발생했습니다. 다시 시도해 주세요." |

# BE_V1_AUTH_007 : 필수 정보 검증
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | BE_V1_AUTH_007 |
| **요구사항명** | 회원가입 후 필수 데이터(키,몸무게) 누락 검증 |
| **우선순위** | 필수(P1) |
| **설명** | 회원 가입 이후, 해당 계정에 연결된 **생년월일, 키, 몸무게** 데이터가 있는지 확인하여 접근 권한을 제어한다. |
| **선행조건** | - 로그인을 통해 서비스 전용 액세스 토큰을 발급받음. |
| **후행조건** | - 데이터 존재 여부에 따라 **정보 입력 페이지로 리다이렉트**. |
| **입력** | - 유저 테이블 내 `phone_number`, `height`, `weight` 필드 값 |
| **출력** | - **음성 안내**: "정확한 가이드를 위해 추가 정보를 입력해야 합니다. 입력 화면으로 이동합니다." |
| **비즈니스 규칙** | - **정보가 모두 저장되는 순간**, 메인 대시보드 진입 권한을 활성화함. |
| **예외 처리** | - **입력 페이지에서 데이터 저장 전 브라우저 종료 시**: 재로그인 시 다시 정보 입력 페이지로 강제 리다이렉트.<br>- **소셜 정보와 수동 입력 정보 충돌 시**: 사용자가 **직접 입력한 정보**를 최우선 순위로 둠. |

# BE_V1_EXERCISE_001: 운동 데이터 로드, 초기화
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | BE_V1_EXERCISE_001 |
| **요구사항명** | 운동 데이터 로드 및 초기화 |
| **우선순위** | P1 |
| **설명** | 운동 시작 시, 서버(또는 로컬)로부터 리소스(오디오, JSON 스크립트, 픽토그램)를 로드하고 플레이어를 준비한다. |
| **선행조건** | - **SETUP 단계**에서 운동이 선택되었다. |
| **후행조건** | - 플레이어 UI가 렌더링되고 리소스 준비가 완료된다. |
| **입력** | - **exercise_id** |
| **출력** | - **UI 렌더링**<br>- **TTS 리소스 준비** |
| **비즈니스 규칙** | 1. **스크립트 데이터**는 JSON 형태로 관리하며 `start_time`, `end_time`, `text`, `action_code`를 포함한다.<br>2. 로딩 중임을 알리는 **청각 신호 (Earcon)**을 반복 재생하여 앱이 멈추지 않았음을 알린다. |
| **예외 처리** | - 네트워크 불안정으로 오디오 파일을 받지 못한 경우, 텍스트 데이터만으로 **TTS (OS 내장)**를 사용하여 재생을 시도한다. |

# BE_V1_EXERCISE_002: 스크립트 싱크 및 픽토그램 동기화
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | BE_V1_EXERCISE_002 |
| **요구사항명** | 스크립트 싱크 및 픽토그램 동기화 |
| **우선순위** | P1  |
| **설명** | 오디오 재생 시간에 맞춰 스크립트를 하이라이팅하고 픽토그램을 갱신한다. |
| **선행조건** | - **플레이어 재생 중** |
| **후행조건** | - 오디오와 시각 정보의 일치 |
| **입력** | - **Current Timestamp (float)**: 현재 오디오의 재생 시간 |
| **출력** | - **Text Highlight Style**: 현재 읽고 있는 문장을 하이라이팅<br>- **Image Update**: 해당 시간에 맞는 픽토그램 갱신 |
| **비즈니스 규칙** | 1. 오디오와 텍스트 하이라이팅의 오차는 **±0.5초 이내**여야 한다.<br>2. 현재 읽고 있는 문장이 화면 **중앙에 오도록** 리스트를 자동 스크롤(Auto-scroll) 한다.<br>3. 저시력자를 위해 활성 텍스트는 **고대비 스타일**(검은 배경/노란 글씨 등)로 적용한다. |
| **예외 처리** | - **타임스탬프 파싱 에러 발생 시**, 하이라이팅 기능을 비활성화하고 오디오만 재생한다. |

# BE_V1_EXERCISE_003: 재생 제어 및 배속 설정
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | BE_V1_EXERCISE_003 |
| **요구사항명** | 재생 제어 및 배속 설정 |
| **우선순위** | P1 |
| **설명** | 재생/일시정지, 구간 이동, 재생 속도(0.5x ~ 4.0x)를 조절한다. |
| **선행조건** | - 플레이어 실행 중 |
| **후행조건** | - 재생 상태 변경 |
| **입력** | - **터치 제스처** (재생/일시정지, 구간 이동)<br>- **배속 설정 값** (0.5x ~ 4.0x) |
| **출력** | - **TTS 피드백**: "배속 2배속으로 변경되었습니다."<br>- **햅틱 피드백**: 배속 변경 또는 구간 이동 시 진동 등의 피드백 제공. |
| **비즈니스 규칙** | 1. 배속 변경 시 **Time-Stretching** 기술을 적용하여 **목소리 톤**(Pitch)을 유지해야 한다.<br>2. **이전/다음** 이동 시 10초 단위가 아닌 **'문장(Segment)' 단위**로 이동한다.<br>3. 상태 변경 시 반드시 변경된 값을 읽어준다 (예: "2배속"). |
| **예외 처리** | - **오디오 디코더 오류로 배속 적용 실패 시**, 1.0배속으로 강제 복귀하고 **"배속을 변경할 수 없습니다"** 안내. |

# BE_V1_EXERCISE_004: VUI(음성 명령)
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | BE_V1_EXERCISE_004 |
| **요구사항명** | VUI(음성 명령) |
| **우선순위** | P2 |
| **설명** | 호출어("시선 코치")를 통해 터치 없이 기능을 제어한다. |
| **선행조건** | - 마이크 권한 허용됨 |
| **후행조건** | - 음성 명령 수행 |
| **입력** | - **User Voice Stream**: 사용자의 음성 데이터 스트림을 입력받음 |
| **출력** | - **Audio Ducking**: 호출어 인식 후 운동 가이드 음성 볼륨을 20%로 줄임<br>- **Action Execution**: 명령어 실행 (예: 멈춤, 시작, 다음, 이전 등) |
| **비즈니스 규칙** | 1. 호출어("시선 코치") 인식 시 운동 가이드 볼륨을 **20%로 줄인다** (Ducking).<br>2. 명령어: **멈춤**, **시작**, **다음**, **이전**, **속도 조절(빠르게/느리게)**.<br>3. 호출 후 5초간 명령이 없으면 **재생 모드**로 자동 복귀. |
| **예외 처리** | - **주변 소음으로 인식 실패 시**: "잘 못 들었어요" 피드백 후 대기 모드 종료.<br>- **마이크 권한이 꺼져 있는 경우**: 기능 비활성화 및 안내 멘트 출력. |

# BE_V1_EXERCISE_005: 플레이리스트 재생 관리 (Transition Manager)
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | **BE_V1_SETUP_005** |
| **요구사항명** | 플레이리스트 재생 관리 (Transition Manager) |
| **우선순위** | P1 |
| **설명** | 생성된 대기열을 순차적으로 재생하고, 운동과 운동 사이의 전환(휴식 및 안내)을 관리한다. |
| **선행조건** | - 대기열(Playlist) 생성 완료 및 첫 번째 운동 시작 |
| **후행조건** | - 모든 운동 완료 후 결과 페이지 이동 |
| **입력** | - **현재 운동 종료 신호 (Event)** |
| **출력** | - **다음 운동 로드 및 재생** |
| **비즈니스 규칙** | 1. 한 운동이 종료되면 **10초간의 휴식 카운트다운**을 진행한다.<br>2. **휴식 시간 동안 TTS 음성 가이드**: "수고하셨습니다. 다음 동작은 런지입니다. 준비하세요."<br>3. **운동 리소스를 로드하는 중 에러 발생 시**, 해당 운동을 건너뛰고(Skip) 다음 운동으로 진행하거나 재시도 옵션을 제공한다. |
| **예외 처리** | - **운동 리소스를 로딩하는 중 에러 발생 시**: "운동 로드에 실패했습니다. 다음 운동으로 넘어가겠습니다." 또는 "운동 로딩에 실패했습니다. 재시도 하시겠습니까?" |

# **BE_V1_LOG_001: 운동 세션 데이터 수집 및 가공**
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | **BE_V1_LOG_001** |
| **요구사항명** | 운동 세션 데이터 수집 및 가공 |
| **우선순위** | P1 |
| **설명** | 운동 시작부터 종료까지의 데이터를 수집하여 구조화된 로그 객체를 생성한다. |
| **선행조건** | - 운동 시작 이벤트 발생 |
| **후행조건** | - 로그 JSON 생성 |
| **입력** | - **System Time**<br>- **User Action Logs** |
| **출력** | - **`ExerciseLog` Dictionary/JSON** |
| **비즈니스 규칙** | 1. 데이터 포맷은 **`user_id`, `exercise_id`, `start_time`/`end_time`, `segments(수행 구간 정보)`**를 포함한다.<br>2. 총 운동 시간이 **10초 미만**인 경우 로그는 생성하되 **`is_valid: False`**로 마킹한다.<br>3. 시간 기록은 **소수점 단위(float)**까지 정밀하게 기록한다. |
| **예외 처리** | - **앱 강제 종료** 등으로 종료 시간이 기록되지 않은 경우, 마지막 핑(Ping) 시간을 종료 시간으로 추정하거나 **'비정상 종료'**로 마킹한다. |

# **BE_V1_LOG_002: 로그 서버 전송 및 캐싱**
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | **BE_V1_LOG_002** |
| **요구사항명** | 로그 서버 전송 및 캐싱 |
| **우선순위** | P1 |
| **설명** | 생성된 로그를 서버로 전송하며, 실패 시 로컬에 저장하고, **S3**에도 로그를 저장하여 백업한다. |
| **선행조건** | - `ExerciseLog` 생성 완료 |
| **후행조건** | - 서버 DB 저장, 로컬 캐시 저장, **S3 저장**(필요 시 백업) |
| **입력** | - **`ExerciseLog` 객체** |
| **출력** | 1. 전송 성공 여부(boolean)<br>2. 로그 저장 식별자(Log Key / Log Name) |
| **비즈니스 규칙** | 1. **전송 실패 시** 로컬 DB(SQLite)에 저장하고, 추후 네트워크 연결 시 백그라운드에서 재전송한다. 또한 **S3**에도 저장하여 데이터 백업 및 관리한다.<br>2. 전송 전 운동 결과 요약(총 시간, 칼로리 등)을 **TTS로 안내**한다.<br>3. **S3**에 로그를 저장하며, 로컬 저장소 용량이 부족한 경우 **S3로 로그 백업**을 통해 용량 부족 문제를 해결한다. |
| **예외 처리** | - **로컬 저장소 용량 부족** 시, 가장 오래된 미전송 로그를 삭제하고 최신 로그를 저장한다 (FIFO).<br>- **S3 저장 실패** 시, 해당 로그를 로컬에 백업하고 **재시도** 옵션을 제공한다. |

# **BE_V1_SETUP_001:** 운동 모드 선택
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | **BE_V1_SETUP_001** |
| **요구사항명** | 운동 모드 선택 (단일/루틴) |
| **우선순위** | P1 |
| **설명** | 사용자는 **'단일 운동 모드'**와 **'루틴 운동 모드'** 중 하나를 선택한다. |
| **선행조건** | - 메인 화면 진입 |
| **후행조건** | - 선택된 모드의 하위 메뉴(카테고리/즐겨찾기 등)로 이동 |
| **입력** | - 사용자 선택 (Touch) |
| **출력** | - **UI 화면 전환** |
| **비즈니스 규칙** | 1. **단일 운동 모드**: 개별 운동을 하나씩 수행. 카테고리별 조회 또는 즐겨찾기/최근 운동 조회 가능.<br>2. **루틴 운동 모드**: 여러 운동을 연속으로 수행. 시스템 추천 루틴(카테고리별) 또는 나만의 루틴(커스텀) 수행 가능. |

# **BE_V1_SETUP_002: 단일 운동 구성 (즐겨찾기/카테고리)**
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | **BE_V1_SETUP_002** |
| **요구사항명** | 단일 운동 선택 및 즐겨찾기 |
| **우선순위** | P1 |
| **설명** | 사용자는 카테고리(근력/유산소/유연성/균형)를 통해 운동을 찾거나, **'즐겨찾기/자주 한 운동'** 탭에서 빠르게 운동을 선택하여 시작한다. |
| **선행조건** | - 단일 운동 모드 진입 |
| **후행조건** | - 운동 실행 준비 상태(`Exercise` 객체 로드) |
| **입력** | - 카테고리 선택 or 즐겨찾기 탭 선택 |
| **출력** | - **운동 목록 리스트** |
| **비즈니스 규칙** | 1. **즐겨찾기 제공**: 사용자가 '좋아요'한 운동 목록을 보여준다.<br>2. **자주 한 운동(옵션)**: 최근 30일 내 수행 횟수가 많은 상위 운동 노출.<br>3. 운동 선택 시 즉시 해당 운동의 상세/재생 화면으로 진입. |

# **BE_V1_SETUP_003: 루틴 운동 구성 (시스템/커스텀)**
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | **BE_V1_SETUP_003** |
| **요구사항명** | 루틴 운동 선택 (추천/나만의 루틴) |
| **우선순위** | P1 |
| **설명** | 사용자는 시스템이 제공하는 카테고리별 추천 루틴을 선택하거나, 직접 조합해 저장한 **'나만의 루틴'**을 선택한다. |
| **선행조건** | - 루틴 운동 모드 진입 |
| **후행조건** | - 루틴 대기열(`Playlist`) 생성 및 재생 준비 |
| **입력** | - 루틴 선택 (System Routine ID or Custom Routine ID) |
| **출력** | - **운동 대기열 로드** |
| **비즈니스 규칙** | 1. **시스템 루틴**: 카테고리(근력/유산소 등)와 난이도에 맞춰 사전 정의된 운동 조합.<br>2. **나만의 루틴**: `BE_V1_SETUP_004`를 통해 사용자가 저장한 조합.<br>3. 선택 시 전체 운동 목록(Playlist)을 인스턴스화 하여 재생 준비. |

# **BE_V1_SETUP_004: 나만의 루틴 생성 및 저장**
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | **BE_V1_SETUP_004** |
| **요구사항명** | 나만의 루틴 생성 (조합 및 저장) |
| **우선순위** | P2 |
| **설명** | 사용자는 단일 운동들을 **원하는 순서대로 조합**하여 새로운 루틴을 만들고, **이름을 붙여 저장**한다. |
| **선행조건** | - 루틴 생성 화면 진입 |
| **후행조건** | - 새로운 커스텀 루틴(`CustomRoutine`) DB 저장 |
| **입력** | - 선택된 운동 목록 (Exercise IDs)<br>- 루틴 이름 (routine_name) |
| **출력** | - **저장 완료 메시지**: "나만의 루틴이 저장되었습니다." |
| **비즈니스 규칙** | 1. **운동 조합**: 원하는 운동을 N개 선택하여 순서를 지정한다.<br>2. **이름 지정**: 루틴을 식별할 수 있는 이름을 입력받는다.<br>3. 저장된 루틴은 '루틴 운동 모드'의 '나만의 루틴' 탭에서 언제든 불러올 수 있다. |

# BE_V1_USER_001 : 프로필 조회
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | BE_V1_USER_001 |
| **요구사항명** | 프로필 조회 |
| **우선순위** | 필수 (P1) |
| **설명** | 현재 로그인된 사용자의 기본 프로필 정보를 조회한다. |
| **선행조건** | - 유효한 Access Token을 보유한 로그인 상태 |
| **후행조건** | - 없음 |
| **입력** | - 없음 (인증 토큰을 통해 사용자 식별) |
| **출력** | - user_id (내부 식별자)<br>- display_name (사용자명)<br>- (선택) phone_number_masked<br>- "현재 로그인된 계정은 {display_name} 님입니다.” |
| **비즈니스 규칙** | 1. 프로필 정보는 Access Token에 포함된 사용자 식별자를 기준으로 조회한다.<br>2. 사용자는 자신의 프로필 정보만 조회할 수 있으며, 다른 사용자의 정보는 조회할 수 없다.<br>3. 사용자명(display_name)은 음성 안내(TTS)에 사용된다. |
| **예외 처리** | - 인증되지 않은 요청인 경우:<br>- "로그인이 필요합니다." 안내 후 로그인 화면으로 유도<br>- 토큰이 만료되었거나 유효하지 않은 경우:<br>- Refresh Token 플로우 수행 또는 재로그인 유도 |

# BE_V1_USER_002 : 프로필 수정
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | BE_V1_USER_002 |
| **요구사항명** | 프로필 수정 |
| **우선순위** | 필수 (P1) |
| **설명** | 사용자의 신체 정보(키, 몸무게)를 수정한다.<br>(전화번호 변경은 별도 본인인증 플로우로 분리한다.) |
| **선행조건** | - 로그인 상태(유효한 Access Token 보유)<br>- 수정할 데이터가 유효성 검사를 통과해야 함 |
| **후행조건** | x |
| **입력** | `phone_number` (선택)<br>`height` (선택)<br>`weight` (선택) |
| **출력** | - 수정 완료 TTS 메시지<br>- 업데이트된 유저 객체<br>- "프로필이 수정되었습니다.” |
| **비즈니스 규칙** | 1. 본인 프로필만 수정 가능하며, Access Token 기반으로 사용자 식별한다.<br>2. 입력된 필드만 수정하는 PATCH 방식 사용<br>3. 키 범위: 50~250cm<br>4. 몸무게 범위: 20~300kg<br>5. 값 형식: 숫자만 허용(단위는 cm/kg로 고정) |
| **예외 처리** | - 인증되지 않은 요청: "로그인이 필요합니다."<br>- 유효성 오류(범위/형식): "입력 값을 다시 확인해주세요."<br>- 서버/DB 오류: "수정에 실패했습니다. 다시 시도해주세요.” |

# BE_V1_USER_003 : 운동 리포트
| 항목 | 내용 |
| --- | --- |
| **요구사항 ID** | BE_V1_USER_003 |
| **요구사항명** | 주간/일일 운동 데이터 요약 리포트 조회 |
| **우선순위** | 필수 (P1) |
| **설명** | 사용자의 운동 로그(ExerciseLog)를 집계하여 일일/주간 운동 통계와 추정 소모 칼로리를 제공한다.<br>결과는 TTS로 요약 가능한 텍스트 형태를 포함한다. |
| **선행조건** | - 로그인 상태(유효한 Access Token)<br>- 프로필에 weight가 존재해야 함(칼로리 계산용)<br>- (권장) height는 선택(추후 확장) |
| **후행조건** | - 없음 (조회) |
| **입력** | - period_type: DAILY \| WEEKLY<br>- base_date: YYYY-MM-DD (기준일)<br>- DAILY: 해당 날짜<br>- WEEKLY: 기준일이 포함된 주(월~일 등 정책 고정 필요) |
| **출력** | - summary_json:<br>- period_range (start_date, end_date)<br>- total_exercise_time_sec<br>- completed_session_count (is_valid=true)<br>- (선택) invalid_session_count (is_valid=false 또는 abnormal 종료)<br>- exercise_count (수행 동작 수)<br>- estimated_calories (weight 기반 추정)<br>- category_breakdown (주간일 때 권장)<br>- tts_summary_text:<br>- 예: "이번 주 운동은 3회, 총 42분입니다. 예상 소모 칼로리는 180칼로리입니다.” |
| **비즈니스 규칙** | 1. 집계 대상은 기본적으로 is_valid=true인 세션을 포함한다.<br>2. is_valid=false 또는 비정상 종료 세션은 별도 카운트로만 제공할 수 있다(옵션).<br>3. 칼로리 계산은 사용자 최신 weight(kg)를 사용한다.<br>4. 칼로리 계산식(권장):<br>- exercise.met_value 기반 MET 모델 또는 운동별 kcal/min 모델 중 하나를 채택한다.<br>5. 결과는 화면 표시용 JSON과 TTS 요약 텍스트를 함께 제공한다. |
| **예외 처리** | - weight가 없는 경우:<br>- "칼로리 계산을 위해 몸무게 정보가 필요합니다." 안내 및 정보 입력 유도<br>- 해당 기간에 유효 로그가 없는 경우:<br>- 0 값으로 응답하되 "해당 기간에 기록된 운동이 없습니다." 안내 텍스트 제공<br>- 비정상 종료 로그만 존재하는 경우:<br>- 완료 운동 0회 + 미완료 n회로 표기(옵션) |